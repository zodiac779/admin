function imageSelectHandler(e){$(e.parentNode.parentNode.parentNode).find("#"+e.id+"_box").remove(),$(e.parentNode.parentNode.parentNode).append($("<div>").prop({id:e.id+"_box"}).css("padding-top","10px"));var t=$("#"+e.id+"_box"),n=e.id,r=$("#"+n)[0].files[0],i=/^(image\/jpeg|image\/png|image\/gif)$/i,s=$("#"+n).attr("data-width"),o=$("#"+n).attr("data-height"),u=o/s;if(!i.test(r.type))return alert("Please select a valid image file (jpg png and gif are allowed)"),$("#"+n).prop("value",""),!1;t.find("img.jcrop-preview").remove(),t.find("div#preview-pane").remove(),t.find("input[type=hidden]").remove();var a=$("<img>").prop({id:n+"_show"});a.css({"max-width":"500px"}),a.hide(),a.appendTo(t);var f=$("<img>");f.addClass("jcrop-preview"),f.hide(),t.append('<input type="hidden" id="'+n+'_x1" name="'+n+'_x1" value="0" />'),t.append('<input type="hidden" id="'+n+'_y1" name="'+n+'_y1" value="0" />'),t.append('<input type="hidden" id="'+n+'_w" name="'+n+'_w" />'),t.append('<input type="hidden" id="'+n+'_h" name="'+n+'_h" />'),t.append('<input type="hidden" id="'+n+'_iWidth" name="'+n+'_iWidth" value="'+s+'" />'),t.append('<input type="hidden" id="'+n+'_iHeight" name="'+n+'_iHeight" value="'+o+'" />'),t.append('<input type="hidden" id="'+n+'_watermark" name="'+n+'_watermark" value="false" />'),t.append('<label style="margin-top: 5px;"><input type="checkbox" id="'+n+'_cwatermark" name="'+n+'_cwatermark" /> Add Watermark</label>'),t.append($("<div>").addClass("col-md-6 responsive-1024").prop({id:"preview-pane"}).css({width:"264px",height:u*250+14+"px"}).append($("<div>").addClass("preview-container").css({width:"250px",height:u*250+"px"}).append(f)));var l=new FileReader;l.onload=function(e){function m(e){if(v.naturalWidth>=t.find("div.jcrop-holder img").width())var r=v.naturalWidth/t.find("div.jcrop-holder img").width();if(v.naturalHeight>=t.find("div.jcrop-holder img").height())var i=v.naturalHeight/t.find("div.jcrop-holder img").height();if(v.naturalWidth<t.find("div.jcrop-holder img").width())var r=1;if(v.naturalHeight<t.find("div.jcrop-holder").find("img").height())var i=1;$("#"+n+"_x1").val(e.x*r),$("#"+n+"_y1").val(e.y*i),$("#"+n+"_w").val(e.w*r),$("#"+n+"_h").val(e.h*i)}function g(e){if(parseInt(e.w)>0){var t=h/e.w,n=p/e.h;l.css({width:Math.round(t*i)+"px",height:Math.round(n*u)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(n*e.y)+"px"})}}$("#"+n+'_cwatermark[type="checkbox"]').iCheck({handle:"checkbox",checkboxClass:"icheckbox_flat",radioClass:"iradio_flat"}),$("#"+n+'_cwatermark[type="checkbox"]').on("ifChecked",function(e){$("#"+n+'_watermark[type="hidden"]').val("true")}),$("#"+n+'_cwatermark[type="checkbox"]').on("ifUnchecked",function(e){$("#"+n+'_watermark[type="hidden"]').val("false")});var r,i,u,a=t.find("div#preview-pane"),f=t.find("div.preview-container"),l=t.find("img[class=jcrop-preview]"),c=s/o,h=f.width(),p=f.height(),d=t.find("#"+n+"_show"),v=document.getElementById(n+"_show");d.prop({src:e.target.result}),l.prop({src:e.target.result}),d.Jcrop({bgColor:null,onChange:g,onSelect:g,onSelect:m,aspectRatio:c},function(){var e=this.getBounds();i=e[0],u=e[1],r=this,a.appendTo(r.ui.holder)}),c>=0?($("#"+n+"_w").val(l.width()),$("#"+n+"_h").val(l.width()*(o/s)),l.css({width:"250px",height:250*(t.find("img").height()/t.find("img").width())+"px",marginLeft:"0px",marginTop:"0px"})):($("#"+n+"_w").val(l.height()*(s/o)),$("#"+n+"_h").val(l.height()),l.css({width:250*(t.find("img").width()/t.find("img").height())+"px",height:250*(t.find("img").height()/t.find("img").width())+"px",marginLeft:"0px",marginTop:"0px"})),l.show()},l.readAsDataURL(r)};